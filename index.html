<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Street-to-Slick Tire Converter</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    background: url('A_photograph_captures_a_close-up_of_a_racing_slick.png') no-repeat center center fixed;
    background-size: cover;
    transition: background-color 0.3s, color 0.3s;
    color: #000;
  }

  .dark-mode {
    background-color: #111 !important;
    color: white !important;
  }

  .container {
    max-width: 600px;
    margin: auto;
  }

  .box {
    background: rgba(255, 255, 255, 0.85);
    padding: 15px;
    border-radius: 8px;
    margin-top: 20px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  }

  .dark-mode .box {
    background: rgba(255, 255, 255, 0.12);
  }

  select,
  input[type="text"],
  button {
    padding: 10px;
    margin-top: 5px;
    width: 100%;
    font-size: 1rem;
    border-radius: 4px;
    border: 1px solid #ccc;
    background-color: #fff;
    color: #000;
  }

  .dark-mode select,
  .dark-mode input[type="text"],
  .dark-mode button {
    background-color: #333;
    color: white;
    border: 1px solid #666;
  }

.lang-selector {
  position: absolute;
  top: 10px;
  right: 20px;
  font-size: 1rem;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 5px;
  padding: 10px;
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 4px;
  color: #000;
  
}
body {
  font-family: "Segoe UI Emoji", "Apple Color Emoji", "Noto Color Emoji", sans-serif;
}
.dark-mode .lang-selector {
  background: rgba(0, 0, 0, 0.8);
  color: white;
}

.lang-selector span {
  cursor: pointer;
  font-size: 1.2rem;
}

  .result {
    margin-top: 10px;
    padding: 10px;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 4px;
  }

  .compare {
    margin-top: 20px;
    padding: 10px;
    background: rgba(255, 255, 255, 0.85);
    border-radius: 5px;
  }

  .dark-mode .result,
  .dark-mode .compare {
    background: rgba(255, 255, 255, 0.12);
    color: white;
  }
  input[type="number"] {
  appearance: none;
  -moz-appearance: textfield;
  -webkit-appearance: none;
}
</style>
<script src="slick_database.js"></script>
</head>

<body>


<script>
function loadSlickDatabase(callback) {
  const script = document.createElement('script');
  script.src = 'slick_database.js'; // make sure it's in the same directory
  script.onload = callback;
  script.onerror = () => alert("Failed to load slick_database.js");
  document.head.appendChild(script);
}

document.addEventListener("DOMContentLoaded", () => {
  loadSlickDatabase(() => {
    if (typeof slickDatabase === 'undefined') {
      alert('slickDatabase failed to load');
      return;
    }

    const translations = {
      en: {
        title: "Street to Slick Tire Converter",
        car: "Car",
        motorcycle: "Motorcycle",
        toggleDark: "Dark",
        front: "Front Tire",
        rear: "Rear Tire",
        custom: "Custom Size",
        summary: "Comparison Summary",
        invalid: "Invalid format. Use 225/40R18.",
        street: "Street Tire:",
        diameter: "Calculated Diameter:",
        slick: "Suggested Slick Size:",
        disclaimer: "⚠️ The suggested slick size is an approximation. Always verify and use the closest available size."
      }
    };

    let currentLang = 'en';
    let currentMode = 'car';
    const t = () => translations[currentLang];

function createElem(tag, attrs = {}, text = '') {
  const el = document.createElement(tag);
  for (let key in attrs) {
    if (key === 'style') {
      if (typeof attrs[key] === 'string') {
        el.setAttribute('style', attrs[key]);
      } else {
        Object.assign(el.style, attrs[key]);
      }
    } else if (key.startsWith('on')) {
      el.addEventListener(key.slice(2), attrs[key]);
    } else {
      el.setAttribute(key, attrs[key]);
    }
  }
  if (text) el.textContent = text;
  return el;
}


    function parseTire(str) {
      const match = str.match(/(\d{2,3})\/(\d{2})R(\d{2})/);
      if (!match) return null;
      const width = +match[1], aspect = +match[2], rim = +match[3];
      const sidewall = width * (aspect / 100);
      const diameter = 2 * sidewall + rim * 25.4;
      return { width, aspect, rim, diameter: Math.round(diameter) };
    }

    function buildUI() {
      const oldContainer = document.getElementById('tireApp');
      if (oldContainer) oldContainer.remove();

      const container = createElem('div', { id: 'tireApp', class: 'container' });
      container.appendChild(createElem('h2', {}, t().title));

      const controls = createElem('div', { class: 'box' });
      ['car', 'motorcycle'].forEach(mode => {
        controls.appendChild(createElem('button', {
          onclick: () => {
            currentMode = mode;
            populateTires();
          }
        }, t()[mode]));
      });
      controls.appendChild(createElem('button', {
        onclick: () => document.body.classList.toggle('dark-mode')
      }, t().toggleDark));
      container.appendChild(controls);

      ['front', 'rear'].forEach(pos => {
        const section = createElem('div', { class: 'box' });
        section.appendChild(createElem('h3', {}, t()[pos]));
        const select = createElem('select', { id: `${pos}Input`, onchange: () => convertTire(pos) });
        section.appendChild(select);
section.appendChild(createElem('button', {
  onclick: () => toggleCustomInput(pos),
  'data-toggle': pos
}, t().custom));

        section.appendChild(createElem('div', { class: 'result', id: `${pos}Result` }));
        section.appendChild(createElem('button', {
          onclick: () => showSuggestions(pos)
        }, "Show Suggested Sizes"));
        container.appendChild(section);
      });

      container.appendChild(createElem('div', { class: 'compare', id: 'comparison' }));
      container.appendChild(createElem('div', {
        style: "margin-top:20px;font-size:0.9rem;text-align:center;color:rgba(0,0,0,0.6);"
      }, t().disclaimer));
      document.body.appendChild(container);
      populateTires();
    }

function populateTires() {
  const popularSizes = [
    '185/65R14', '195/65R15', '205/55R16', '205/60R16',
    '215/45R17', '225/45R17', '235/45R17',
    '225/40R18', '235/40R18', '245/40R18', '255/35R18',
    '225/35R19', '235/35R19', '245/35R19', '255/35R19',
    '275/30R20', '285/30R20'
  ];

  ['front', 'rear'].forEach(pos => {
    const sel = document.getElementById(`${pos}Input`);
    sel.innerHTML = '';

    const slickSizes = [...new Set(slickDatabase.map(t =>
      `${t.width}/${Math.round((t.diameter - t.rim * 25.4) / 2 / t.width * 100)}R${t.rim}`
    ))];

    const allSizes = Array.from(new Set([...slickSizes, ...popularSizes]));

    // Group and sort sizes
    const groups = {};
    allSizes.forEach(size => {
      const match = size.match(/(\d{3})\/\d{2}R(\d{2})/);
      if (!match) return;
      const width = parseInt(match[1]);
      const rim = parseInt(match[2]);
      if (!groups[rim]) groups[rim] = [];
      groups[rim].push({ size, width });
    });

    const sortedRims = Object.keys(groups).map(Number).sort((a, b) => a - b);

    sortedRims.forEach(rim => {
      const optgroup = document.createElement('optgroup');
      optgroup.label = `R${rim}`;
      const sizes = groups[rim].sort((a, b) => a.width - b.width);
      sizes.forEach(({ size }) => {
        optgroup.appendChild(createElem('option', { value: size }, size));
      });
      sel.appendChild(optgroup);
    });

    convertTire(pos);
  });
}



function toggleCustomInput(pos) {
  const button = document.querySelector(`#${pos}Input`)?.nextElementSibling || document.querySelector(`button[data-toggle="${pos}"]`);
  const input = document.getElementById(`${pos}Input`);
  const isSelect = input.tagName === 'SELECT';

  let container;

  if (isSelect) {
    // ✅ Create container to hold 3 fields + separators
    container = createElem('div', { id: `${pos}Input`, style: { display: 'flex', gap: '5px', alignItems: 'center' } });

const sharedInputStyle = {
  width: '152px',
  fontSize: '1.05rem',
  padding: '6px 8px',
  appearance: 'textfield',
  MozAppearance: 'textfield',
  WebkitAppearance: 'none'
};


    const widthField = createElem('input', {
      type: 'number',
      placeholder: 'Width',
      style: sharedInputStyle,
      oninput: () => convertTire(pos),
      id: `${pos}Width`
    });

    const slash = createElem('span', {
      style: {
        fontWeight: 'bold',
        fontSize: '1.1rem',
        padding: '0 4px'
      }
    }, '/');

    const aspectField = createElem('input', {
      type: 'number',
      placeholder: 'Aspect',
      style: sharedInputStyle,
      oninput: () => convertTire(pos),
      id: `${pos}Aspect`
    });

    const rLabel = createElem('span', {
      style: {
        fontWeight: 'bold',
        fontSize: '1.1rem',
        padding: '0 4px'
      }
    }, 'R');

    const rimField = createElem('input', {
      type: 'number',
      placeholder: 'Rim',
      style: sharedInputStyle,
      oninput: () => convertTire(pos),
      id: `${pos}Rim`
    });

    container.appendChild(widthField);
    container.appendChild(slash);
    container.appendChild(aspectField);
    container.appendChild(rLabel);
    container.appendChild(rimField);

    button.textContent = 'Popular Sizes';
  } else {
    // ✅ Revert to popular sizes <select>
    container = createElem('select', {
      id: `${pos}Input`,
      onchange: () => convertTire(pos)
    });

    const slickSizes = [...new Set(slickDatabase.map(t =>
      `${t.width}/${Math.round((t.diameter - t.rim * 25.4) / 2 / t.width * 100)}R${t.rim}`
    ))];

    const popularSizes = [
      '185/65R14', '195/65R15', '205/55R16', '205/60R16',
      '215/45R17', '225/45R17', '235/45R17',
      '225/40R18', '235/40R18', '245/40R18', '255/35R18',
      '225/35R19', '235/35R19', '245/35R19', '255/35R19',
      '275/30R20', '285/30R20'
    ];

    const allSizes = Array.from(new Set([...slickSizes, ...popularSizes]));

    const groups = {};
    allSizes.forEach(size => {
      const match = size.match(/(\d{3})\/\d{2}R(\d{2})/);
      if (!match) return;
      const width = parseInt(match[1]);
      const rim = parseInt(match[2]);
      if (!groups[rim]) groups[rim] = [];
      groups[rim].push({ size, width });
    });

    const sortedRims = Object.keys(groups).map(Number).sort((a, b) => a - b);
    sortedRims.forEach(rim => {
      const optgroup = document.createElement('optgroup');
      optgroup.label = `R${rim}`;
      const sizes = groups[rim].sort((a, b) => a.width - b.width);
      sizes.forEach(({ size }) => {
        optgroup.appendChild(createElem('option', { value: size }, size));
      });
      container.appendChild(optgroup);
    });

    button.textContent = 'Custom Size';
  }

  input.replaceWith(container);
  convertTire(pos);
}


    function convertTire(pos) {
      const input = document.getElementById(`${pos}Input`);
      const val = input.value.trim();
      const res = document.getElementById(`${pos}Result`);
      const data = parseTire(val);
      if (!data) {
        res.innerHTML = `<span style="color:red">${t().invalid}</span>`;
        return;
      }

      const matches = slickDatabase.filter(t =>
        Math.abs(t.diameter - data.diameter) <= 10 &&
        Math.abs(t.width - data.width) <= 10
      );

      const closest = matches.length > 0
        ? matches.reduce((best, curr) => {
          const score = Math.abs(curr.diameter - data.diameter) + Math.abs(curr.width - data.width);
          const bestScore = Math.abs(best.diameter - data.diameter) + Math.abs(best.width - data.width);
          return score < bestScore ? curr : best;
        }) : null;

      res.innerHTML = `
        <strong>${t().street}</strong> ${val}<br>
        <strong>${t().diameter}</strong> ${data.diameter} mm<br>
        <strong>${t().slick}</strong> ${closest ? closest.size : "No match found"}`;

      updateComparison();
    }

    function updateComparison() {
      const c = document.getElementById('comparison');
      c.innerHTML = `<h3>${t().summary}</h3>` +
        document.getElementById('frontResult').innerHTML +
        '<br><br>' +
        document.getElementById('rearResult').innerHTML;
    }

    function showSuggestions(pos) {
      const input = document.getElementById(`${pos}Input`);
      const data = parseTire(input.value.trim()) || { diameter: 0, width: 0 };

      const popup = createElem('div', {
        style: `position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
                max-height:80vh;overflow:auto;padding:20px;background:rgba(255,255,255,0.95);
                border-radius:12px;box-shadow:0 0 20px rgba(0,0,0,0.4);z-index:9999;
                backdrop-filter:blur(24px)`
      });

      popup.innerHTML = `<h3>Suggested Slick Tires</h3>`;
      const table = createElem('table', { style: 'width:100%;border-collapse:collapse' });

      const rows = slickDatabase
        .filter(t => Math.abs(t.diameter - data.diameter) <= 10 && Math.abs(t.width - data.width) <= 10)
        .map(t =>
          `<tr><td>${t.brand}</td><td>${t.size}</td><td>${t.diameter}</td><td>${t.rim}</td><td><a href="${t.link}" target="_blank">Link</a></td></tr>`
        ).join('');

      table.innerHTML = `
        <thead><tr><th>Brand</th><th>Size</th><th>Diameter</th><th>Rim</th><th>Link</th></tr></thead>
        <tbody>${rows || '<tr><td colspan="5">No matches</td></tr>'}</tbody>
      `;
      popup.appendChild(table);
      const close = createElem('button', { onclick: () => popup.remove(), style: { marginTop: '10px' } }, 'Close');
      popup.appendChild(close);
      document.body.appendChild(popup);
    }

    buildUI();
  });
});
</script>

</body>
</html>
